{"version":3,"sources":["lib/wallet_session.ts","lib/algorand.ts","App.tsx","index.tsx"],"names":["WalletSession","network","accounts","defaultAccount","connector","this","WalletConnect","bridge","qrcodeModal","WalletConnectQRCodeModal","cb","a","connected","createSession","on","error","payload","params","Promise","resolve","reconn","setInterval","clearInterval","connect","killSession","isConnected","txns","defaultAddress","getDefaultAccount","txnsToSign","map","txn","encodedTxn","Buffer","from","algosdk","encodeUnsignedTransaction","toString","encodeAddress","publicKey","signers","request","formatJsonRpcRequest","sendCustomRequest","result","element","idx","txID","blob","Uint8Array","config","host","token","port","iface","ABIInterface","ABIdef","getMethodByName","name","m","methods","find","mt","undefined","Error","client","Algodv2","asset_id","app_addr","getApplicationAddress","accountAssetInformation","do","ainfo","sendWait","stxns","sendRawTransaction","txId","waitForConfirmation","getAirdropTxns","sender","signer","makeBasicAccountTransactionSigner","getTransactionParams","sp","atc","AtomicTransactionComposer","addTransaction","makeAssetTransferTxnWithSuggestedParamsFromObject","assetIndex","to","suggestedParams","amount","addMethodCall","appID","method","methodArgs","buildGroup","tws","App","React","useState","loading","setLoading","wallet","remaining","setRemaining","parseInt","window","location","pathname","split","useEffect","countRemaining","then","cnt","isNaN","links","aidx","push","href","className","alert","signTxn","signed","stxn","console","log","buttons","elevation","Elevation","TWO","intent","onClick","triggerDrop","text","hidden","ReactDOM","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.6a081e9f.chunk.js","sourcesContent":["import algosdk, { Transaction, TransactionParams } from \"algosdk\";\n\nimport WalletConnect from \"@walletconnect/client\";\nimport WalletConnectQRCodeModal from \"algorand-walletconnect-qrcode-modal\";\n\nimport { formatJsonRpcRequest } from \"@json-rpc-tools/utils\";\n\n\ninterface SignedTxn {\n    txID: string\n    blob: Uint8Array\n};\n\nexport default class WalletSession {\n  accounts: string[];\n  defaultAccount: number;\n  network: string;\n  connector: WalletConnect;\n\n  constructor(network: string) {\n    this.accounts = [];\n    this.defaultAccount = 0;\n    this.network = network;\n    this.connector = new WalletConnect({\n        bridge : \"https://bridge.walletconnect.org\",\n        qrcodeModal: WalletConnectQRCodeModal,\n    });\n  }\n\n  async connect(cb: any): Promise<boolean> {\n    // Check if connection is already established\n    if (this.connector.connected) return true;\n\n    this.connector.createSession();\n\n    this.connector.on(\"connect\", (error, payload) => {\n      if (error) {\n        throw error;\n      }\n      const { accounts } = payload.params[0];\n      this.accounts = accounts;\n      cb(accounts);\n    });\n\n    this.connector.on(\"session_update\", (error, payload) => {\n      if (error) {\n        throw error;\n      }\n      const { accounts } = payload.params[0];\n      this.accounts = accounts;\n      cb(accounts);\n    });\n\n    this.connector.on(\"disconnect\", (error, payload) => {\n      if (error) throw error;\n    });\n\n\n    return new Promise(resolve=>{\n      const reconn = setInterval(() => {\n        if (this.connector.connected) {\n          clearInterval(reconn);\n          resolve(true);\n          return;\n        }\n        this.connector.connect();\n      }, 100);\n    });\n  }\n\n  isConnected(): boolean {\n    return this.connector.connected;\n  }\n\n  disconnect() {\n    this.connector.killSession();\n  }\n\n  getDefaultAccount(): string {\n    if (!this.isConnected()) return \"\";\n    return this.connector.accounts[this.defaultAccount];\n  }\n\n  async signTxn(txns: Transaction[]): Promise<SignedTxn[]> {\n    const defaultAddress = this.getDefaultAccount();\n    const txnsToSign = txns.map((txn) => {\n      const encodedTxn = Buffer.from(\n        algosdk.encodeUnsignedTransaction(txn)\n      ).toString(\"base64\");\n\n      if (algosdk.encodeAddress(txn.from.publicKey) !== defaultAddress)\n        return { txn: encodedTxn, signers: [] };\n      return { txn: encodedTxn };\n    });\n\n    const request = formatJsonRpcRequest(\"algo_signTxn\", [txnsToSign]);\n\n    const result: string[] = await this.connector.sendCustomRequest(request);\n\n    return result.map((element, idx) => {\n      return element\n        ? {\n            txID: txns[idx].txID(),\n            blob: new Uint8Array(Buffer.from(element, \"base64\")),\n          }\n        : {\n            txID: txns[idx].txID(),\n            blob: new Uint8Array(),\n          };\n    });\n  }\n\n}","import algosdk from 'algosdk'\nimport ABIdef from \"./abi.json\"\n\n\nexport const config = {\n    appId: 81677804,\n    assets: [81677963, 81677921, 81677898, 81677864, 81677845],\n    algod: {\n        network:\"TestNet\",\n        host: \"https://testnet-api.algonode.cloud\",\n        token: \"\",\n        port: \"\" \n    }\n    //algod: {\n    //    network:\"sandnet-v1\",\n    //    host: 'http://localhost',\n    //    token: \"a\".repeat(64),\n    //    port: 4001\n    //}\n}\n\n\nconst iface = new algosdk.ABIInterface({...ABIdef})\n\n// Utility function to return an ABIMethod by its name\nfunction getMethodByName(name: string): algosdk.ABIMethod  {\n    const m = iface.methods.find((mt: algosdk.ABIMethod)=>{ return mt.name===name })\n    if(m === undefined)\n        throw Error(\"Method undefined: \"+name)\n    return m\n}\n\nconst client = new algosdk.Algodv2(config.algod.token, config.algod.host, config.algod.port)\n\nexport async function countRemaining(asset_id: number): Promise<number> {\n    const app_addr = algosdk.getApplicationAddress(config.appId)\n    const ainfo = await client.accountAssetInformation(app_addr, asset_id).do()\n    return ainfo['asset-holding']['amount']\n}\n\nexport async function sendWait(stxns: Uint8Array[]): Promise<any> {\n    const {txId} = await client.sendRawTransaction(stxns).do()\n    const result = await algosdk.waitForConfirmation(client, txId, 2)\n    return result\n}\n\nexport async function getAirdropTxns(asset_id: number, sender: string): Promise<algosdk.Transaction[]> {\n    const signer = algosdk.makeBasicAccountTransactionSigner({} as algosdk.Account)\n    const sp = await client.getTransactionParams().do()\n    const atc = new algosdk.AtomicTransactionComposer()\n    atc.addTransaction({\n        txn: algosdk.makeAssetTransferTxnWithSuggestedParamsFromObject({\n            assetIndex: asset_id,\n            from: sender,\n            to: sender,\n            suggestedParams: sp,\n            amount: 0\n        }),\n        signer: signer\n    })\n    atc.addMethodCall({\n        appID: config.appId, \n        method: getMethodByName(\"drop\"), \n        sender: sender, \n        suggestedParams: sp,\n        methodArgs:[asset_id],\n        signer: signer \n    })\n    return atc.buildGroup().map((tws)=>{ return tws.txn})\n}","import React from 'react';\nimport {config, getAirdropTxns, sendWait, countRemaining} from './lib/algorand'\nimport WalletSession from \"./lib/wallet_session\"\nimport {Card, Button, Elevation} from \"@blueprintjs/core\"\n\n\nfunction App() {\n  const [loading, setLoading] = React.useState(false)\n  const [wallet, setWallet] = React.useState(new WalletSession(config.algod.network))\n  const [remaining, setRemaining] = React.useState(0)\n\n  const asset_id = parseInt(window.location.pathname.split(\"/\")[1])\n\n  React.useEffect(()=>{\n    if(wallet.isConnected()) return;\n    wallet.connect(()=>{})\n  }, [wallet])\n\n  React.useEffect(()=>{\n    countRemaining(asset_id).then((cnt:number)=>{\n      setRemaining(cnt)\n    })\n  }, [loading])\n\n\n  // If no asset id in path, just dump links\n  if(isNaN(asset_id) || asset_id === undefined){\n    const links = []\n    for(const aidx of config.assets){\n        links.push(<a key={aidx} href={'/'+aidx.toString()}>{aidx}</a>)\n    }\n    return (\n      <div className='container'>\n        {links}\n      </div>\n    )\n  }\n\n  async function triggerDrop(asset_id: number){\n    if(!wallet.isConnected()) {\n      alert(\"Not connected to wallet!\")\n      return\n    }\n    setLoading(true)\n    const txns = await getAirdropTxns(asset_id, wallet.getDefaultAccount())\n    const signed = await wallet.signTxn(txns)\n    const result = await sendWait(signed.map((stxn)=>{return stxn.blob}))\n    setLoading(false)\n    console.log(result)\n  }\n\n  const buttons = []\n  for(const aidx of config.assets){\n    if(asset_id === aidx) buttons.push()\n  }\n  \n\n  return (\n    <div className=\"container\">\n      <div className='content'>\n        <Card elevation={Elevation.TWO}>\n          <h3>{remaining} Left</h3> \n          <Button \n              intent='success'\n              onClick={()=>{triggerDrop(asset_id)}}\n              key={'asset-'+asset_id.toString()} \n              text={'Drop ' + asset_id.toString()} \n              loading={loading}\n            />\n        </Card>\n      </div>\n      <div hidden={true}> </div>\n    </div>\n  );\n\n    //<audio src='https://github.com/anars/blank-audio/blob/master/30-seconds-of-silence.mp3?raw=true' ></audio>\n}\n\nexport default App;\n","import React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App  />\n  </React.StrictMode>,\n  document.getElementById('root')\n);"],"sourceRoot":""}